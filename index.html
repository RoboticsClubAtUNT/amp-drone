<!doctype html>
<html>
  <head>
    <title>jeffBot</title>
    <script type="text/javascript" src= "/socket.io/socket.io.js"></script>
    <script type="text/javascript" src="/static/jquery/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="/static/bootstrap/js/bootstrap.js"></script>
    <script type="text/javascript" src="/static/bootstrap/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/static/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="/static/bootstrap/css/bootstrap-social.css">
    <link rel="stylesheet" type="text/css" href="/static/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/static/font-awesome/css/font-awesome.css">
    <link rel="stylesheet" type="text/css" href="/static/theme.css">
  </head>
  <body>
    <script type="text/javascript">
        var socket = io.connect('http://raspberrypi:3030');  // change to the server IP address
        var gamepadInfo = document.getElementById("gamepad-info");
        var ball = document.getElementById("ball");
        var start;
        var a = 0;
        var b = 0;
        var interval;

        if (!('ongamepadconnected' in window)) {
          // No gamepad events available, poll instead.
          interval = setInterval(pollGamepads, 500);
        }

        function pollGamepads() {
        var gamepads = navigator.getGamepads ? navigator.getGamepads() : (navigator.webkitGetGamepads ? navigator.webkitGetGamepads : []);
        for (var i = 0; i < gamepads.length; i++) {
          var gp = gamepads[i];
          if (gp) {
            $('#gamepad-info').text("Gamepad connected at index " + gp.index + ": " + gp.id +
              ". It has " + gp.buttons.length + " buttons and " + gp.axes.length + " axes.");
            gameLoop();
            clearInterval(interval);
            }
          }
        }

        window.addEventListener("gamepaddisconnected", function(e) {
          console.log("Gamepad disconnected from index %d: %s",
          e.gamepad.index, e.gamepad.id);
        });

        function buttonPressed(pad, buttonId) {
          if (pad && buttonId) {
            var buttonIndex = BUTTONS[buttonId];
            if (buttonIndex === 4 || buttonIndex === 5) {
              console.log('button');
              return self.gamepads[pad].buttons[buttonIndex] > self.SHOULDER0_BUTTON_THRESHOLD;
            } else if (buttonIndex === 6 || buttonIndex === 7) {
              console.log('button');
              return self.gamepads[pad].buttons[buttonIndex] > self.SHOULDER1_BUTTON_THRESHOLD;
            } else {
              console.log('button');
              return self.gamepads[pad].buttons[buttonIndex] > 0.5;
            }
          } else {
            return false;
          }
        };

        function gameLoop() {
          var gamepads = navigator.getGamepads ? navigator.getGamepads() : (navigator.webkitGetGamepads ? navigator.webkitGetGamepads : []);
          if (!gamepads) {
            return;
          }

          var gp = gamepads[0];
          if (buttonPressed(gp, gp.buttons[0])) {
            b--;
          } else if (buttonPressed(gp, gp.buttons[2])) {
            b++;
          }
          if (buttonPressed(gp, gp.buttons[1])) {
            a++;
          } else if (buttonPressed(gp, gp.buttons[3])) {
            a--;
          }

          start = requestAnimationFrame(gameLoop);
        }

        function autoDrive()
        {
          socket.emit('autoDrive');
        }

        function newPic()
        {
          socket.emit('pic');
        }

        socket.on('newPic', function(data)
        {
          var d = new Date();
          var pic = document.getElementById('picRobot');
          var newImage = 'static/robot.jpg?' + d.getMilliseconds();
          pic.src = newImage;
        });

        function stopPic()
        {
          socket.emit('stopPic');
        }

    </script>
    <div class="container">
        <div class="row">
            <div class="col-sm-8">
                <h1>AMP-Drone<small> -A UNTRC project</small></h1>
                <img id="picRobot" src="static/robot.jpg?" height="480" width="640" alt="No image found">
                <div class="btn-group">
                    <button id="picRobotBtn" type="button" class="btn btn-default" onclick="newPic()">Get Feed</button>
                    <button id="stopButton" type="button" class="btn btn-default" onclick="stopPic()">Stop Feed</button>
                    <div id="gamepad-info"></div>
                </div>
            </div>
        </div>
    </div>

  </body>
</html>
